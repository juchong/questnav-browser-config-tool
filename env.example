# Environment Variables Configuration

**Location for local development:** `backend/.env`  
**Location for Docker deployment:** Root directory or docker-compose.yml

Copy this template to create your `.env` file:

```bash
cp env.example .env
```

## Server Configuration

```bash
NODE_ENV=development
PORT=3000

# Enable debug logging (optional, default: false)
# Backend: Set in backend/.env or environment
DEBUG_MODE=false
```

**Frontend Debug Mode:**
Create `frontend/.env.local` (not tracked in git):
```bash
VITE_DEBUG_MODE=true
```
This enables detailed connection, command execution, and APK installation logs in the browser console.

## Local Development

For local HTTP development (allows HTTP for specified IP ranges):

```bash
ALLOW_HTTP_LOCAL=true
LOCAL_SUBNETS=127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
```

**Note:** 
- Only set `ALLOW_HTTP_LOCAL=true` for local development
- `LOCAL_SUBNETS` is a comma-separated list of IPs/CIDR ranges
- Default includes localhost and private network ranges (RFC 1918)
- In production, leave `ALLOW_HTTP_LOCAL` unset or set to `false` to enforce HTTPS for all traffic
- CSP is applied per-request based on client IP - external traffic always gets HTTPS enforcement

## Database

```bash
DATABASE_PATH=./data/questnav.db
```

## CORS Configuration

For development:
```bash
CORS_ORIGIN=http://localhost:5173
```

For production (official domain):
```bash
CORS_ORIGIN=https://setup.questnav.gg
```

**Note:** In production, the server automatically allows the official domain (https://setup.questnav.gg) and localhost for development testing.

## Rate Limiting

```bash
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=100   # Maximum requests per window (production only)
```

**Note:** Rate limiting is automatically relaxed in development mode to account for React Strict Mode and hot-reloading:
- **Development:** 1000 requests per 15 minutes (global), higher limits on specific endpoints
- **Production:** 100 requests per 15 minutes (global), strict limits on endpoints

Individual endpoint limits:
- Login attempts: 50 (dev) / 5 (prod) per 15 minutes
- Log creation: 100 (dev) / 5 (prod) per minute
- APK cache requests: 100 (dev) / 10 (prod) per 15 minutes
- APK status checks: 200 (dev) / 20 (prod) per 5 minutes

## Authentication (Required)

**IMPORTANT:** Change these values for production!

```bash
ADMIN_USERNAME=admin
ADMIN_PASSWORD=change-this-password-in-production
```

## JWT Configuration

Generate a secure random string for JWT_SECRET in production:

```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

Then set:

```bash
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d  # Token expiration (e.g., 7d, 24h, 60m)
```

## GitHub Webhook Configuration (Optional)

For automatic APK release detection from the QuestNav repository:

```bash
# Repository to monitor (default: QuestNav/QuestNav)
QUESTNAV_REPO=QuestNav/QuestNav

# Webhook secret for signature verification
# Generate a random string: openssl rand -hex 32
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here

# Maximum APK file size in bytes (default: 500MB)
MAX_APK_SIZE_BYTES=524288000
```

**Setup Instructions:**
1. Go to the QuestNav repository settings on GitHub
2. Navigate to Webhooks â†’ Add webhook
3. Set Payload URL to: `https://setup.questnav.gg/api/webhooks/github`
4. Set Content type to: `application/json`
5. Set Secret to match your `GITHUB_WEBHOOK_SECRET`
6. Select "Let me select individual events" and check only "Releases"
7. Click "Add webhook"

**Note:** If `GITHUB_WEBHOOK_SECRET` is not set, webhook signature verification will be skipped (not recommended for production).

## Example Complete .env File

```env
# Server Configuration
NODE_ENV=production
PORT=3000

# Local Development (set to true only for local HTTP development)
# ALLOW_HTTP_LOCAL=true
# LOCAL_SUBNETS=127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Database
DATABASE_PATH=./data/questnav.db

# CORS Configuration
CORS_ORIGIN=https://setup.questnav.gg

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Authentication
ADMIN_USERNAME=admin
ADMIN_PASSWORD=YourSecurePasswordHere123!

# JWT Configuration
JWT_SECRET=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
JWT_EXPIRES_IN=7d

# GitHub Webhook (Optional)
QUESTNAV_REPO=QuestNav/QuestNav
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here
MAX_APK_SIZE_BYTES=524288000
```

## Security Notes

1. **Never commit your `.env` file to version control** - it's already in `.gitignore`
2. Use strong, unique passwords for `ADMIN_PASSWORD`
3. Generate a truly random `JWT_SECRET` using the command above
4. In production, always use `NODE_ENV=production`
5. The official production domain is `https://setup.questnav.gg`
6. Public endpoints (profiles, logs, APK downloads) are accessible without authentication by design
7. Admin endpoints require authentication and should only be accessed by authorized personnel

