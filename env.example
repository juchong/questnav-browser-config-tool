# Environment Variables Configuration

**Location for local development:** `backend/.env`  
**Location for Docker deployment:** Root directory or docker-compose.yml

Copy this template to create your `.env` file:

```bash
cp env.example .env
```

## Server Configuration

```bash
NODE_ENV=development
PORT=3000
```

## Local Development

For local HTTP development (allows HTTP for specified IP ranges):

```bash
ALLOW_HTTP_LOCAL=true
LOCAL_SUBNETS=127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
```

**Note:** 
- Only set `ALLOW_HTTP_LOCAL=true` for local development
- `LOCAL_SUBNETS` is a comma-separated list of IPs/CIDR ranges
- Default includes localhost and private network ranges (RFC 1918)
- In production, leave `ALLOW_HTTP_LOCAL` unset or set to `false` to enforce HTTPS for all traffic
- CSP is applied per-request based on client IP - external traffic always gets HTTPS enforcement

## Database

```bash
DATABASE_PATH=./data/questnav.db
```

## CORS Configuration

For development:
```bash
CORS_ORIGIN=http://localhost:5173
```

For production:
```bash
CORS_ORIGIN=https://yourdomain.com
```

## Rate Limiting

```bash
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=100   # Maximum requests per window
```

## Authentication (Required)

**IMPORTANT:** Change these values for production!

```bash
ADMIN_USERNAME=admin
ADMIN_PASSWORD=change-this-password-in-production
```

## JWT Configuration

Generate a secure random string for JWT_SECRET in production:

```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

Then set:

```bash
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d  # Token expiration (e.g., 7d, 24h, 60m)
```

## Example Complete .env File

```env
# Server Configuration
NODE_ENV=production
PORT=3000

# Local Development (set to true only for local HTTP development)
# ALLOW_HTTP_LOCAL=true
# LOCAL_SUBNETS=127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Database
DATABASE_PATH=./data/questnav.db

# CORS Configuration
CORS_ORIGIN=https://yourdomain.com

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Authentication
ADMIN_USERNAME=admin
ADMIN_PASSWORD=YourSecurePasswordHere123!

# JWT Configuration
JWT_SECRET=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
JWT_EXPIRES_IN=7d
```

## Security Notes

1. **Never commit your `.env` file to version control** - it's already in `.gitignore`
2. Use strong, unique passwords for `ADMIN_PASSWORD`
3. Generate a truly random `JWT_SECRET` using the command above
4. In production, always use `NODE_ENV=production`
5. Set `CORS_ORIGIN` to your actual domain, not `*`

